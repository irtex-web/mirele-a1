"use strict";const CompoundEditor=Project.export("editor",new Interface({requires:{vue:!0,jquery:!0},elements:{vue:["#compound-editor-body"]},vue:{delimiters:["{","}"],el:"#compound-editor-body",data:{markup:[]},mounted:function(){this.__updateMarkup().then(()=>{jQuery("[data-component=\"body\"][data-namespace=\"editor\"]").removeClass("hidden"),jQuery("[data-component=\"spinner\"][data-namespace=\"editor\"]").addClass("hidden");const a=this;document.addEventListener("keydown",function(b){const c=b.key;if("Delete"===c){const b=jQuery("[data-component=\"field-body\"][data-selected]").map((a,b)=>jQuery(b).attr("data-id"));0<b.length&&a.removeTemplate({template:b}).then(()=>{a.reloadPage(),$("[data-component=\"field-body\"][data-selected]").selectable("refresh")}).catch(()=>{})}}),jQuery("[data-behavior=\"editor-template\"][data-namespace=\"editor\"][data-component=\"editor-body\"]").selectable({filter:"[data-component=\"field-body\"]",cancel:"[data-component=\"template-control\"],[data-component=\"field-component\"]",selected:function(a,b){jQuery(b.selected).attr("data-selected",!0)},selecting:function(a,b){jQuery(b.selected).attr("data-selected",!0)},unselected:function(a,b){jQuery(b.unselected).removeAttr("data-selected")},unselecting:function(a,b){jQuery(b.unselected).removeAttr("data-selected")}}),jQuery("[data-behavior=\"editor-template\"]").sortable({axis:"y",containment:"document",disabled:!0,tolerance:"pointer",placeholder:"__compound_box_placeholder",connectWith:jQuery("[data-behavior=\"droppable\"][data-namespace=\"editor\"]"),helper:"clone",opacity:.5,cursor:"move",forcePlaceholderSize:!0,revert:80,update:function(){var a=[];for(const[b,c]of Object.entries(jQuery("[data-component=\"field\"][data-namespace=\"editor\"]"))){const b=jQuery(c).attr("data-id");b&&a.push(b)}new WPAjax("Compound-sort",{page:Compound.page_on_edit||0,order:a})},start:(a,b)=>{jQuery("[data-role=\"trash\"][data-namespace=\"editor\"]").removeClass("hidden"),this.__renderDroppable(),this.__renderPlaceholder(b)},stop:()=>{jQuery("[data-behavior=\"editor-template\"][data-namespace=\"editor\"][data-component=\"editor-body\"]").sortable("option","disabled",!0),jQuery("[data-role=\"trash\"][data-namespace=\"editor\"]").addClass("hidden")}})}).catch(()=>{jQuery("[data-component=\"error\"][data-namespace=\"editor\"]").removeClass("hidden"),jQuery("[data-component=\"spinner\"][data-namespace=\"editor\"]").addClass("hidden")})},methods:{editProps:function(a){const b=Project.import("@form-props").vue;return b.__editor=this,b.open(Object.assign({page:Compound.page_on_edit||0},a))},insertComponent:function(a){const b=Project.import("@form-createComponent").vue;return b.__editor=this,b.open(Object.assign({page:Compound.page_on_edit||0},a))},insertTemplate:function(a){const b=Project.import("@form-insertTemplate").vue;return b.__editor=this,b.open(Object.assign({page:Compound.page_on_edit||0},a))},removeTemplate:function(a){return new WPAjax("Compound-removeTemplate",{page:Compound.page_on_edit||0,template:a.template})},reloadPage:function(){jQuery("[data-namespace=\"editor\"][data-component=\"editor-body\"]").animate({opacity:.3}),this.__updateMarkup().then(()=>{jQuery("[data-namespace=\"editor\"][data-component=\"editor-body\"]").animate({opacity:1})}).catch(()=>{jQuery("[data-namespace=\"editor\"][data-component=\"editor-body\"]").animate({opacity:1})})},__moveEnabled:function(){jQuery("[data-behavior=\"editor-template\"][data-namespace=\"editor\"][data-component=\"editor-body\"]").sortable("option","disabled",!1)},__menuActionRemoveTemplate:function(a){const b=new WPAjax("Compound-removeTemplate",{page:Compound.page_on_edit||0,template:a.template});b.then(()=>{this.__updateMarkup()}).catch(()=>{})},__menuActionEditTemplate:function(){},__metaFieldClass__:function(a){const b=(a||{}).editor||{};return`__compound_field col-${b.col||12}`},__updateMarkup:function(){return new Promise((a,b)=>{new WPAjax("Compound-getMarkup",{page:Compound.page_on_edit||0}).then(b=>{var c=[];for(const[a,d]of Object.entries(b.data.data))c.push({name:d.props.name||"default",id:a,fields:d.fields,props:d.props});this.markup=c,a(b.data.data)}).catch(a=>{b(a)})})},__renderDroppable:function(){return jQuery("[data-behavior=\"droppable\"]").droppable({accept:jQuery("[data-component=\"field\"][data-namespace=\"editor\"]"),activeClass:"wp-mrl-trash-active",hoverClass:"wp-mrl-trash-hover",drop:(a,b)=>{const c=jQuery(b.helper.context).attr("data-id");this.removeTemplate({template:c}),b.draggable.remove()}})},__renderPlaceholder:function(a){return a.placeholder.height(a.item.height())}},filters:{capitalize:function(a){return a?(a=a.toString(),a.charAt(0).toUpperCase()+a.slice(1)):""}}},ready:function(){}}));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0QsQ0FDbkQsTUFBTSxDQUFFLE1BQU0sQ0FBQyx1REFBRCxDQURxQyxDQUVuRCxXQUFXLENBQUUscUJBRnNDLENBR25ELFVBQVUsQ0FBRSxvQkFIdUMsQ0FLbkQsSUFBSSxDQUFFLENBQUMsQ0FBRCxDQUFRLENBQVIsR0FBZSxDQUNqQixLQUFNLENBQUEsQ0FBUyxDQUFHLE1BQU0sQ0FBQyxDQUFFLENBQUMsTUFBSCxDQUFVLE9BQVgsQ0FBTixDQUEwQixJQUExQixDQUErQixTQUEvQixDQUFsQixDQUNBLEtBQUssY0FBTCxDQUFvQixDQUFDLFFBQVEsQ0FBRSxDQUFYLENBQXBCLENBRmlCLENBR2pCLENBQUUsQ0FBQyxTQUFILENBQWEsTUFBYixFQUNILENBVGtELENBQWhELENBV1YsQ0F2SUksQ0F5SUwsbUJBQW1CLENBQUUsU0FBVSxDQUFWLENBQWlCLENBQ2xDLE1BQU8sQ0FBQSxDQUFLLENBQUMsV0FBTixDQUFrQixNQUFsQixDQUF5QixDQUFLLENBQUMsSUFBTixDQUFXLE1BQVgsRUFBekIsQ0FDVixDQTNJSSxDQTVHUixDQXlQRCxPQUFPLENBQUUsQ0FDTCxVQUFVLENBQUUsU0FBVSxDQUFWLENBQWlCLE9BQ3BCLENBQUEsQ0FEb0IsRUFFekIsQ0FBSyxDQUFHLENBQUssQ0FBQyxRQUFOLEVBRmlCLENBR2xCLENBQUssQ0FBQyxNQUFOLENBQWEsQ0FBYixFQUFnQixXQUFoQixHQUFnQyxDQUFLLENBQUMsS0FBTixDQUFZLENBQVosQ0FIZCxFQUNOLEVBR3RCLENBTEksQ0F6UFIsQ0FScUQsQ0F5UTFELEtBQUssQ0FBRSxVQUFvQixDQUUxQixDQTNReUQsQ0FBZCxDQUF6QixDQUF2QiIsImZpbGUiOiJjb21wb3VuZC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFdlbGNvbWUgdG8gdGhlIHNvdXJjZSBjb2RlXG4gKlxuICog4paI4paI4paI4pWX4paR4paR4paR4paI4paI4paI4pWX4paI4paI4pWX4paI4paI4paI4paI4paI4paI4pWX4paR4paI4paI4paI4paI4paI4paI4paI4pWX4paI4paI4pWX4paR4paR4paR4paR4paR4paI4paI4paI4paI4paI4paI4paI4pWXICAgICAgICDilpHilpHilpHilpHilpHilojilojilZfilpHilojilojilojilojilojilojilZdcbiAqIOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKVlOKVkOKVkOKVkOKVkOKVneKWiOKWiOKVkeKWkeKWkeKWkeKWkeKWkeKWiOKWiOKVlOKVkOKVkOKVkOKVkOKVnSAgICAgICAg4paR4paR4paR4paR4paR4paI4paI4pWR4paI4paI4pWU4pWQ4pWQ4pWQ4pWQ4pWdXG4gKiDilojilojilZTilojilojilojilojilZTilojilojilZHilojilojilZHilojilojilojilojilojilojilZTilZ3ilojilojilojilojilojilZfilpHilpHilojilojilZHilpHilpHilpHilpHilpHilojilojilojilojilojilZfilpHilpEgICAgICAgIOKWkeKWkeKWkeKWkeKWkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKWiOKVl+KWkVxuICog4paI4paI4pWR4pWa4paI4paI4pWU4pWd4paI4paI4pWR4paI4paI4pWR4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4pWd4paR4paR4paI4paI4pWR4paR4paR4paR4paR4paR4paI4paI4pWU4pWQ4pWQ4pWd4paR4paRICAgICAgICDilojilojilZfilpHilpHilojilojilZHilpHilZrilZDilZDilZDilojilojilZdcbiAqIOKWiOKWiOKVkeKWkeKVmuKVkOKVneKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKWiOKWiOKWiOKVlyAgICAgICAg4pWa4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4paI4paI4paI4paI4pWU4pWdXG4gKiDilZrilZDilZ3ilpHilpHilpHilpHilpHilZrilZDilZ3ilZrilZDilZ3ilZrilZDilZ3ilpHilpHilZrilZDilZ3ilZrilZDilZDilZDilZDilZDilZDilZ3ilZrilZDilZDilZDilZDilZDilZDilZ3ilZrilZDilZDilZDilZDilZDilZDilZ0gICAgICAgIOKWkeKVmuKVkOKVkOKVkOKVkOKVneKWkeKVmuKVkOKVkOKVkOKVkOKVkOKVneKWkVxuICpcbiAqIOKWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKWiOKVl+KWiOKWiOKVl+KWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWkVxuICog4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4paI4paI4pWX4paR4paI4paI4paI4paI4pWR4paI4paI4pWR4paI4paI4paI4paI4pWX4paR4paI4paI4pWR4paI4paI4pWR4paI4paI4pWU4pWQ4pWQ4pWQ4pWQ4pWd4pWa4pWQ4pWQ4paI4paI4pWU4pWQ4pWQ4pWd4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4pWa4pWQ4pWQ4paI4paI4pWU4pWQ4pWQ4pWd4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWXXG4gKiDilojilojilojilojilojilojilojilZHilojilojilZHilpHilpHilojilojilZHilojilojilZTilojilojilojilojilZTilojilojilZHilojilojilZHilojilojilZTilojilojilZfilojilojilZHilojilojilZHilZrilojilojilojilojilojilZfilpHilpHilpHilpHilojilojilZHilpHilpHilpHilojilojilojilojilojilojilZTilZ3ilojilojilojilojilojilojilojilZHilpHilpHilpHilojilojilZHilpHilpHilpHilojilojilZHilpHilpHilojilojilZHilojilojilojilojilojilojilZTilZ1cbiAqIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKVlOKVneKWiOKWiOKVkeKWiOKWiOKVkeKWiOKWiOKVkeKVmuKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkeKWkeKVmuKVkOKVkOKVkOKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl1xuICog4paI4paI4pWR4paR4paR4paI4paI4pWR4paI4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4pWR4paR4pWa4pWQ4pWd4paR4paI4paI4pWR4paI4paI4pWR4paI4paI4pWR4paR4pWa4paI4paI4paI4pWR4paI4paI4pWR4paI4paI4paI4paI4paI4paI4pWU4pWd4paR4paR4paR4paI4paI4pWR4paR4paR4paR4paI4paI4pWR4paR4paR4paI4paI4pWR4paI4paI4pWR4paR4paR4paI4paI4pWR4paR4paR4paR4paI4paI4pWR4paR4paR4paR4pWa4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4pWR4paR4paR4paI4paI4pWRXG4gKiDilZrilZDilZ3ilpHilpHilZrilZDilZ3ilZrilZDilZDilZDilZDilZDilZ3ilpHilZrilZDilZ3ilpHilpHilpHilpHilpHilZrilZDilZ3ilZrilZDilZ3ilZrilZDilZ3ilpHilpHilZrilZDilZDilZ3ilZrilZDilZ3ilZrilZDilZDilZDilZDilZDilZ3ilpHilpHilpHilpHilZrilZDilZ3ilpHilpHilpHilZrilZDilZ3ilpHilpHilZrilZDilZ3ilZrilZDilZ3ilpHilpHilZrilZDilZ3ilpHilpHilpHilZrilZDilZ3ilpHilpHilpHilpHilZrilZDilZDilZDilZDilZ3ilpHilZrilZDilZ3ilpHilpHilZrilZDilZ1cbiAqXG4gKlxuICpcbiAqIEBwYWNrYWdlIE1pcmVsZVxuICogQGF1dGhvciBNaXJlbGVcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKlxuICogQHNlZSBodHRwczovL3Z1ZWpzLm9yZy92Mi9ndWlkZS9cbiAqL1xuXG5cInVzZSBzdHJpY3RcIjtcblxuY29uc3QgQ29tcG91bmRFZGl0b3IgPSBQcm9qZWN0LmV4cG9ydCgnZWRpdG9yJywgbmV3IEludGVyZmFjZSh7XG4gICAgcmVxdWlyZXM6IHtcbiAgICAgICAgdnVlOiB0cnVlLFxuICAgICAgICBqcXVlcnk6IHRydWVcbiAgICB9LFxuICAgIGVsZW1lbnRzOiB7XG4gICAgICAgIHZ1ZTogWycjY29tcG91bmQtZWRpdG9yLWJvZHknXVxuICAgIH0sXG4gICAgdnVlOiB7XG4gICAgICAgIGRlbGltaXRlcnM6IFsneycsICd9J10sXG4gICAgICAgIGVsOiBcIiNjb21wb3VuZC1lZGl0b3ItYm9keVwiLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBtYXJrdXA6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIG1vdW50ZWQ6IGZ1bmN0aW9uIChFdmVudCkge1xuXG4gICAgICAgICAgICB0aGlzLl9fdXBkYXRlTWFya3VwKCkudGhlbihEYXRhID0+IHtcblxuICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtY29tcG9uZW50PVwiYm9keVwiXVtkYXRhLW5hbWVzcGFjZT1cImVkaXRvclwiXScpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ1tkYXRhLWNvbXBvbmVudD1cInNwaW5uZXJcIl1bZGF0YS1uYW1lc3BhY2U9XCJlZGl0b3JcIl0nKS5hZGRDbGFzcygnaGlkZGVuJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBIb3RrZXkgcmVnaXN0cmF0aW9uXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBldmVudC5rZXk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IFwiRGVsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0ICR0ZW1wbGF0ZXMgPSBqUXVlcnkoJ1tkYXRhLWNvbXBvbmVudD1cImZpZWxkLWJvZHlcIl1bZGF0YS1zZWxlY3RlZF0nKS5tYXAoKGksIGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeShlbCkuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGVtcGxhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbW92ZVRlbXBsYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICR0ZW1wbGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKEV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWxvYWRQYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ1tkYXRhLWNvbXBvbmVudD1cImZpZWxkLWJvZHlcIl1bZGF0YS1zZWxlY3RlZF0nKS5zZWxlY3RhYmxlKCBcInJlZnJlc2hcIiApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKEV2ZW50ID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBqUXVlcnkoJ1tkYXRhLWJlaGF2aW9yPVwiZWRpdG9yLXRlbXBsYXRlXCJdW2RhdGEtbmFtZXNwYWNlPVwiZWRpdG9yXCJdW2RhdGEtY29tcG9uZW50PVwiZWRpdG9yLWJvZHlcIl0nKS5zZWxlY3RhYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEtY29tcG9uZW50PVwiZmllbGQtYm9keVwiXScsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbDogJ1tkYXRhLWNvbXBvbmVudD1cInRlbXBsYXRlLWNvbnRyb2xcIl0sW2RhdGEtY29tcG9uZW50PVwiZmllbGQtY29tcG9uZW50XCJdJyxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkodWkuc2VsZWN0ZWQpLmF0dHIoJ2RhdGEtc2VsZWN0ZWQnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpbmc6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkodWkuc2VsZWN0ZWQpLmF0dHIoJ2RhdGEtc2VsZWN0ZWQnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGVkOiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHVpLnVuc2VsZWN0ZWQpLnJlbW92ZUF0dHIoJ2RhdGEtc2VsZWN0ZWQnKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGluZzogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSh1aS51bnNlbGVjdGVkKS5yZW1vdmVBdHRyKCdkYXRhLXNlbGVjdGVkJylcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtYmVoYXZpb3I9XCJlZGl0b3ItdGVtcGxhdGVcIl0nKS5zb3J0YWJsZSh7XG5cbiAgICAgICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiBcImRvY3VtZW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0b2xlcmFuY2U6IFwicG9pbnRlclwiLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJfX2NvbXBvdW5kX2JveF9wbGFjZWhvbGRlclwiLFxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0V2l0aDogalF1ZXJ5KCdbZGF0YS1iZWhhdmlvcj1cImRyb3BwYWJsZVwiXVtkYXRhLW5hbWVzcGFjZT1cImVkaXRvclwiXScpLFxuICAgICAgICAgICAgICAgICAgICBoZWxwZXI6ICdjbG9uZScsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiBcIm1vdmVcIixcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VQbGFjZWhvbGRlclNpemU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJldmVydDogODAsXG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkb3JkZXIgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbaW5kZXgsIGVsZW1lbnRdIG9mIE9iamVjdC5lbnRyaWVzKGpRdWVyeSgnW2RhdGEtY29tcG9uZW50PVwiZmllbGRcIl1bZGF0YS1uYW1lc3BhY2U9XCJlZGl0b3JcIl0nKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCAkaWQgPSBqUXVlcnkoZWxlbWVudCkuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLnB1c2goJGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFJlcXVlc3QgPSBuZXcgV1BBamF4KCdDb21wb3VuZC1zb3J0Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IENvbXBvdW5kLnBhZ2Vfb25fZWRpdCB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiAkb3JkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiAoZXZlbnQsIHVpKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtcm9sZT1cInRyYXNoXCJdW2RhdGEtbmFtZXNwYWNlPVwiZWRpdG9yXCJdJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fcmVuZGVyRHJvcHBhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fcmVuZGVyUGxhY2Vob2xkZXIodWkpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0b3A6IChldmVudCwgdWkpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCdbZGF0YS1iZWhhdmlvcj1cImVkaXRvci10ZW1wbGF0ZVwiXVtkYXRhLW5hbWVzcGFjZT1cImVkaXRvclwiXVtkYXRhLWNvbXBvbmVudD1cImVkaXRvci1ib2R5XCJdJykuc29ydGFibGUoXCJvcHRpb25cIiwgXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtcm9sZT1cInRyYXNoXCJdW2RhdGEtbmFtZXNwYWNlPVwiZWRpdG9yXCJdJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSkuY2F0Y2goRGF0YSA9PiB7XG5cbiAgICAgICAgICAgICAgICBqUXVlcnkoJ1tkYXRhLWNvbXBvbmVudD1cImVycm9yXCJdW2RhdGEtbmFtZXNwYWNlPVwiZWRpdG9yXCJdJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtY29tcG9uZW50PVwic3Bpbm5lclwiXVtkYXRhLW5hbWVzcGFjZT1cImVkaXRvclwiXScpLmFkZENsYXNzKCdoaWRkZW4nKTtcblxuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICB9LFxuICAgICAgICBtZXRob2RzOiB7XG5cbiAgICAgICAgICAgIGVkaXRQcm9wczogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGZvcm0gPSBQcm9qZWN0LmltcG9ydCgnQGZvcm0tcHJvcHMnKS52dWU7XG4gICAgICAgICAgICAgICAgJGZvcm0uX19lZGl0b3IgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiAkZm9ybS5vcGVuKE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiBDb21wb3VuZC5wYWdlX29uX2VkaXQgfHwgMFxuICAgICAgICAgICAgICAgIH0sIGV2ZW50KSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBpbnNlcnRDb21wb25lbnQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0ICRmb3JtID0gUHJvamVjdC5pbXBvcnQoJ0Bmb3JtLWNyZWF0ZUNvbXBvbmVudCcpLnZ1ZTtcbiAgICAgICAgICAgICAgICAkZm9ybS5fX2VkaXRvciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRmb3JtLm9wZW4oT2JqZWN0LmFzc2lnbih7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2U6IENvbXBvdW5kLnBhZ2Vfb25fZWRpdCB8fCAwLFxuICAgICAgICAgICAgICAgIH0sIGV2ZW50KSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBpbnNlcnRUZW1wbGF0ZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGZvcm0gPSBQcm9qZWN0LmltcG9ydCgnQGZvcm0taW5zZXJ0VGVtcGxhdGUnKS52dWU7XG4gICAgICAgICAgICAgICAgJGZvcm0uX19lZGl0b3IgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiAkZm9ybS5vcGVuKE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiBDb21wb3VuZC5wYWdlX29uX2VkaXQgfHwgMCxcbiAgICAgICAgICAgICAgICB9LCBldmVudCkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVtb3ZlVGVtcGxhdGU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgV1BBamF4KCdDb21wb3VuZC1yZW1vdmVUZW1wbGF0ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZTogQ29tcG91bmQucGFnZV9vbl9lZGl0IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBldmVudC50ZW1wbGF0ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVsb2FkUGFnZTogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgalF1ZXJ5KCdbZGF0YS1uYW1lc3BhY2U9XCJlZGl0b3JcIl1bZGF0YS1jb21wb25lbnQ9XCJlZGl0b3ItYm9keVwiXScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX191cGRhdGVNYXJrdXAoKS50aGVuKEV2ZW50ID0+IHtcblxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJ1tkYXRhLW5hbWVzcGFjZT1cImVkaXRvclwiXVtkYXRhLWNvbXBvbmVudD1cImVkaXRvci1ib2R5XCJdJykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goRXZlbnQgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtbmFtZXNwYWNlPVwiZWRpdG9yXCJdW2RhdGEtY29tcG9uZW50PVwiZWRpdG9yLWJvZHlcIl0nKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIF9fbW92ZUVuYWJsZWQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGpRdWVyeSgnW2RhdGEtYmVoYXZpb3I9XCJlZGl0b3ItdGVtcGxhdGVcIl1bZGF0YS1uYW1lc3BhY2U9XCJlZGl0b3JcIl1bZGF0YS1jb21wb25lbnQ9XCJlZGl0b3ItYm9keVwiXScpLnNvcnRhYmxlKFwib3B0aW9uXCIsIFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgX19tZW51QWN0aW9uUmVtb3ZlVGVtcGxhdGU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IFJlcXVlc3QgPSBuZXcgV1BBamF4KCdDb21wb3VuZC1yZW1vdmVUZW1wbGF0ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZTogQ29tcG91bmQucGFnZV9vbl9lZGl0IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBldmVudC50ZW1wbGF0ZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgUmVxdWVzdC50aGVuKEV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX3VwZGF0ZU1hcmt1cCgpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKEV2ZW50ID0+IHtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgX19tZW51QWN0aW9uRWRpdFRlbXBsYXRlOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBSZXF1ZXN0ID0gbmV3IFdQQWpheCgnQ29tcG91bmQtcmVtb3ZlVGVtcGxhdGUnLCB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHBhZ2U6IENvbXBvdW5kLnBhZ2Vfb25fZWRpdCB8fCAwLFxuICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZTogZXZlbnQudGVtcGxhdGVcbiAgICAgICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIFJlcXVlc3QudGhlbihFdmVudCA9PiB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuX191cGRhdGVNYXJrdXAoKTtcbiAgICAgICAgICAgICAgICAvLyB9KS5jYXRjaChFdmVudCA9PiB7XG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIF9fbWV0YUZpZWxkQ2xhc3NfXzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGV2ZW50ID0gZXZlbnQgfHwge307XG4gICAgICAgICAgICAgICAgY29uc3QgJGVkaXRvciA9ICRldmVudC5lZGl0b3IgfHwge307XG4gICAgICAgICAgICAgICAgcmV0dXJuIGBfX2NvbXBvdW5kX2ZpZWxkIGNvbC0keyRlZGl0b3IuY29sIHx8IDEyfWA7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBfX3VwZGF0ZU1hcmt1cDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbWFpbiByZXF1ZXN0XG4gICAgICAgICAgICAgICAgICAgIChuZXcgV1BBamF4KCdDb21wb3VuZC1nZXRNYXJrdXAnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiBDb21wb3VuZC5wYWdlX29uX2VkaXQgfHwgMFxuICAgICAgICAgICAgICAgICAgICB9KSkudGhlbihFdmVudCA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkYnVmZmVyID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2lkLCB0ZW1wbGF0ZV0gb2YgT2JqZWN0LmVudHJpZXMoRXZlbnQuZGF0YS5kYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWZmZXIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRlbXBsYXRlLnByb3BzLm5hbWUgfHwgJ2RlZmF1bHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogdGVtcGxhdGUuZmllbGRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wczogdGVtcGxhdGUucHJvcHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXJrdXAgPSAkYnVmZmVyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNvbHZlXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKEV2ZW50LmRhdGEuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goRXZlbnQgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWplY3RcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChFdmVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBfX3JlbmRlckRyb3BwYWJsZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeSgnW2RhdGEtYmVoYXZpb3I9XCJkcm9wcGFibGVcIl0nKS5kcm9wcGFibGUoe1xuICAgICAgICAgICAgICAgICAgICBhY2NlcHQ6IGpRdWVyeSgnW2RhdGEtY29tcG9uZW50PVwiZmllbGRcIl1bZGF0YS1uYW1lc3BhY2U9XCJlZGl0b3JcIl0nKSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlQ2xhc3M6ICd3cC1tcmwtdHJhc2gtYWN0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJDbGFzczogJ3dwLW1ybC10cmFzaC1ob3ZlcicsXG5cbiAgICAgICAgICAgICAgICAgICAgZHJvcDogKGV2ZW50LCB1aSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgJHRlbXBsYXRlID0galF1ZXJ5KHVpLmhlbHBlci5jb250ZXh0KS5hdHRyKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVRlbXBsYXRlKHt0ZW1wbGF0ZTogJHRlbXBsYXRlfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1aS5kcmFnZ2FibGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIF9fcmVuZGVyUGxhY2Vob2xkZXI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5wbGFjZWhvbGRlci5oZWlnaHQoZXZlbnQuaXRlbS5oZWlnaHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgICAgIGNhcGl0YWxpemU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybiAnJ1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHZhbHVlLnNsaWNlKDEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHJlYWR5OiBmdW5jdGlvbiAoRXZlbnQsICQpIHtcblxuICAgIH1cbn0pKTsiXX0=